{
    "sourceFile": "src/frontend/scripts/productos.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1743971135536,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1743971135536,
            "name": "Commit-0",
            "content": "// Gestión de productos\r\nconst productos = {\r\n    // Obtener todos los productos\r\n    async getAll() {\r\n        try {\r\n            const response = await fetch(`${API_URL}/productos`, {\r\n                headers: {\r\n                    'Authorization': `Bearer ${auth.getToken()}`\r\n                }\r\n            });\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('Error:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Crear producto\r\n    async create(productoData) {\r\n        try {\r\n            const formData = new FormData();\r\n            for (let key in productoData) {\r\n                formData.append(key, productoData[key]);\r\n            }\r\n\r\n            const response = await fetch(`${API_URL}/productos`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${auth.getToken()}`\r\n                },\r\n                body: formData\r\n            });\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('Error:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Actualizar producto\r\n    async update(id, productoData) {\r\n        try {\r\n            const formData = new FormData();\r\n            for (let key in productoData) {\r\n                formData.append(key, productoData[key]);\r\n            }\r\n\r\n            const response = await fetch(`${API_URL}/productos/${id}`, {\r\n                method: 'PUT',\r\n                headers: {\r\n                    'Authorization': `Bearer ${auth.getToken()}`\r\n                },\r\n                body: formData\r\n            });\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('Error:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Eliminar producto\r\n    async delete(id) {\r\n        try {\r\n            const response = await fetch(`${API_URL}/productos/${id}`, {\r\n                method: 'DELETE',\r\n                headers: {\r\n                    'Authorization': `Bearer ${auth.getToken()}`\r\n                }\r\n            });\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('Error:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Renderizar lista de productos\r\n    renderList(productos) {\r\n        const container = document.getElementById('productosList');\r\n        container.innerHTML = `\r\n            <table>\r\n                <thead>\r\n                    <tr>\r\n                        <th>ID</th>\r\n                        <th>Nombre</th>\r\n                        <th>Descripción</th>\r\n                        <th>Precio</th>\r\n                        <th>Stock</th>\r\n                        <th>Acciones</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    ${productos.map(producto => `\r\n                        <tr>\r\n                            <td>${producto.id_producto}</td>\r\n                            <td>${producto.nombre}</td>\r\n                            <td>${producto.descripcion}</td>\r\n                            <td>${producto.precio}</td>\r\n                            <td>${producto.stock}</td>\r\n                            <td>\r\n                                <button onclick=\"productos.showEditModal(${producto.id_producto})\">Editar</button>\r\n                                <button onclick=\"productos.delete(${producto.id_producto})\">Eliminar</button>\r\n                            </td>\r\n                        </tr>\r\n                    `).join('')}\r\n                </tbody>\r\n            </table>\r\n        `;\r\n    },\r\n\r\n    // Mostrar modal de edición\r\n    async showEditModal(id) {\r\n        const producto = await this.getById(id);\r\n        const modal = document.getElementById('modal');\r\n        const modalContent = document.getElementById('modalContent');\r\n        \r\n        modalContent.innerHTML = `\r\n            <h3>Editar Producto</h3>\r\n            <form id=\"editProductoForm\">\r\n                <div class=\"form-group\">\r\n                    <label for=\"nombre\">Nombre:</label>\r\n                    <input type=\"text\" id=\"nombre\" value=\"${producto.nombre}\" required>\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label for=\"descripcion\">Descripción:</label>\r\n                    <textarea id=\"descripcion\" required>${producto.descripcion}</textarea>\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label for=\"precio\">Precio:</label>\r\n                    <input type=\"number\" id=\"precio\" value=\"${producto.precio}\" required>\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label for=\"imagen\">Imagen:</label>\r\n                    <input type=\"file\" id=\"imagen\">\r\n                </div>\r\n                <button type=\"submit\">Guardar</button>\r\n            </form>\r\n        `;\r\n\r\n        modal.classList.remove('hidden');\r\n        \r\n        document.getElementById('editProductoForm').addEventListener('submit', async (e) => {\r\n            e.preventDefault();\r\n            const formData = {\r\n                nombre: document.getElementById('nombre').value,\r\n                descripcion: document.getElementById('descripcion').value,\r\n                precio: document.getElementById('precio').value,\r\n                imagen: document.getElementById('imagen').files[0]\r\n            };\r\n            \r\n            try {\r\n                await this.update(id, formData);\r\n                modal.classList.add('hidden');\r\n                this.loadProductos();\r\n            } catch (error) {\r\n                alert(error.message);\r\n            }\r\n        });\r\n    },\r\n\r\n    // Cargar productos\r\n    async loadProductos() {\r\n        try {\r\n            const productos = await this.getAll();\r\n            this.renderList(productos);\r\n        } catch (error) {\r\n            alert('Error al cargar productos');\r\n        }\r\n    }\r\n};\r\n\r\n// Event Listeners\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    const addProductoBtn = document.getElementById('addProductoBtn');\r\n    \r\n    if (addProductoBtn) {\r\n        addProductoBtn.addEventListener('click', () => {\r\n            const modal = document.getElementById('modal');\r\n            const modalContent = document.getElementById('modalContent');\r\n            \r\n            modalContent.innerHTML = `\r\n                <h3>Nuevo Producto</h3>\r\n                <form id=\"addProductoForm\">\r\n                    <div class=\"form-group\">\r\n                        <label for=\"nombre\">Nombre:</label>\r\n                        <input type=\"text\" id=\"nombre\" required>\r\n                    </div>\r\n                    <div class=\"form-group\">\r\n                        <label for=\"descripcion\">Descripción:</label>\r\n                        <textarea id=\"descripcion\" required></textarea>\r\n                    </div>\r\n                    <div class=\"form-group\">\r\n                        <label for=\"precio\">Precio:</label>\r\n                        <input type=\"number\" id=\"precio\" required>\r\n                    </div>\r\n                    <div class=\"form-group\">\r\n                        <label for=\"imagen\">Imagen:</label>\r\n                        <input type=\"file\" id=\"imagen\" required>\r\n                    </div>\r\n                    <button type=\"submit\">Crear</button>\r\n                </form>\r\n            `;\r\n\r\n            modal.classList.remove('hidden');\r\n            \r\n            document.getElementById('addProductoForm').addEventListener('submit', async (e) => {\r\n                e.preventDefault();\r\n                const formData = {\r\n                    nombre: document.getElementById('nombre').value,\r\n                    descripcion: document.getElementById('descripcion').value,\r\n                    precio: document.getElementById('precio').value,\r\n                    imagen: document.getElementById('imagen').files[0]\r\n                };\r\n                \r\n                try {\r\n                    await productos.create(formData);\r\n                    modal.classList.add('hidden');\r\n                    productos.loadProductos();\r\n                } catch (error) {\r\n                    alert(error.message);\r\n                }\r\n            });\r\n        });\r\n    }\r\n}); "
        }
    ]
}