{
    "sourceFile": "src/frontend/scripts/ventas.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1743971174154,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1743971174154,
            "name": "Commit-0",
            "content": "// Gesti√≥n de ventas\r\nconst ventas = {\r\n    // Obtener todas las ventas\r\n    async getAll() {\r\n        try {\r\n            const response = await fetch(`${API_URL}/ventas`, {\r\n                headers: {\r\n                    'Authorization': `Bearer ${auth.getToken()}`\r\n                }\r\n            });\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('Error:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Crear venta\r\n    async create(ventaData) {\r\n        try {\r\n            const response = await fetch(`${API_URL}/ventas`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${auth.getToken()}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify(ventaData)\r\n            });\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('Error:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Obtener detalles de una venta\r\n    async getDetalles(ventaId) {\r\n        try {\r\n            const response = await fetch(`${API_URL}/detalle-ventas/venta/${ventaId}`, {\r\n                headers: {\r\n                    'Authorization': `Bearer ${auth.getToken()}`\r\n                }\r\n            });\r\n            return await response.json();\r\n        } catch (error) {\r\n            console.error('Error:', error);\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    // Renderizar lista de ventas\r\n    renderList(ventas) {\r\n        const container = document.getElementById('ventasList');\r\n        container.innerHTML = `\r\n            <table>\r\n                <thead>\r\n                    <tr>\r\n                        <th>ID</th>\r\n                        <th>Fecha</th>\r\n                        <th>Total</th>\r\n                        <th>Acciones</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    ${ventas.map(venta => `\r\n                        <tr>\r\n                            <td>${venta.id_venta}</td>\r\n                            <td>${new Date(venta.fecha_venta).toLocaleDateString()}</td>\r\n                            <td>${venta.total}</td>\r\n                            <td>\r\n                                <button onclick=\"ventas.showDetalles(${venta.id_venta})\">Ver Detalles</button>\r\n                            </td>\r\n                        </tr>\r\n                    `).join('')}\r\n                </tbody>\r\n            </table>\r\n        `;\r\n    },\r\n\r\n    // Mostrar detalles de una venta\r\n    async showDetalles(ventaId) {\r\n        const detalles = await this.getDetalles(ventaId);\r\n        const modal = document.getElementById('modal');\r\n        const modalContent = document.getElementById('modalContent');\r\n        \r\n        modalContent.innerHTML = `\r\n            <h3>Detalles de la Venta</h3>\r\n            <table>\r\n                <thead>\r\n                    <tr>\r\n                        <th>Producto</th>\r\n                        <th>Cantidad</th>\r\n                        <th>Precio Unitario</th>\r\n                        <th>Subtotal</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    ${detalles.map(detalle => `\r\n                        <tr>\r\n                            <td>${detalle.nombre_producto}</td>\r\n                            <td>${detalle.cantidad}</td>\r\n                            <td>${detalle.precio_unitario}</td>\r\n                            <td>${detalle.subtotal}</td>\r\n                        </tr>\r\n                    `).join('')}\r\n                </tbody>\r\n            </table>\r\n        `;\r\n\r\n        modal.classList.remove('hidden');\r\n    },\r\n\r\n    // Cargar ventas\r\n    async loadVentas() {\r\n        try {\r\n            const ventas = await this.getAll();\r\n            this.renderList(ventas);\r\n        } catch (error) {\r\n            alert('Error al cargar ventas');\r\n        }\r\n    }\r\n};\r\n\r\n// Event Listeners\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    const addVentaBtn = document.getElementById('addVentaBtn');\r\n    \r\n    if (addVentaBtn) {\r\n        addVentaBtn.addEventListener('click', () => {\r\n            const modal = document.getElementById('modal');\r\n            const modalContent = document.getElementById('modalContent');\r\n            \r\n            modalContent.innerHTML = `\r\n                <h3>Nueva Venta</h3>\r\n                <form id=\"addVentaForm\">\r\n                    <div class=\"form-group\">\r\n                        <label for=\"producto\">Producto:</label>\r\n                        <select id=\"producto\" required>\r\n                            <option value=\"\">Seleccione un producto</option>\r\n                        </select>\r\n                    </div>\r\n                    <div class=\"form-group\">\r\n                        <label for=\"cantidad\">Cantidad:</label>\r\n                        <input type=\"number\" id=\"cantidad\" min=\"1\" required>\r\n                    </div>\r\n                    <button type=\"submit\">Crear Venta</button>\r\n                </form>\r\n            `;\r\n\r\n            modal.classList.remove('hidden');\r\n            \r\n            // Cargar productos en el select\r\n            productos.getAll().then(productos => {\r\n                const select = document.getElementById('producto');\r\n                productos.forEach(producto => {\r\n                    const option = document.createElement('option');\r\n                    option.value = producto.id_producto;\r\n                    option.textContent = `${producto.nombre} - $${producto.precio}`;\r\n                    select.appendChild(option);\r\n                });\r\n            });\r\n            \r\n            document.getElementById('addVentaForm').addEventListener('submit', async (e) => {\r\n                e.preventDefault();\r\n                const formData = {\r\n                    id_producto: document.getElementById('producto').value,\r\n                    cantidad: document.getElementById('cantidad').value\r\n                };\r\n                \r\n                try {\r\n                    await ventas.create(formData);\r\n                    modal.classList.add('hidden');\r\n                    ventas.loadVentas();\r\n                } catch (error) {\r\n                    alert(error.message);\r\n                }\r\n            });\r\n        });\r\n    }\r\n}); "
        }
    ]
}